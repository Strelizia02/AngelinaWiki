<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何开发 | AngelinaBot</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/angelina.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.9825735b.css" as="style"><link rel="preload" href="/assets/js/app.c4012ad7.js" as="script"><link rel="preload" href="/assets/js/2.3c2e6582.js" as="script"><link rel="preload" href="/assets/js/13.868abce9.js" as="script"><link rel="prefetch" href="/assets/js/10.3020c85f.js"><link rel="prefetch" href="/assets/js/11.ba3c6fac.js"><link rel="prefetch" href="/assets/js/12.c06732f1.js"><link rel="prefetch" href="/assets/js/14.10dbe749.js"><link rel="prefetch" href="/assets/js/15.28a53bf4.js"><link rel="prefetch" href="/assets/js/16.36d50245.js"><link rel="prefetch" href="/assets/js/17.646e592b.js"><link rel="prefetch" href="/assets/js/18.b1cf4e8f.js"><link rel="prefetch" href="/assets/js/19.3d700c1e.js"><link rel="prefetch" href="/assets/js/20.662eaa6b.js"><link rel="prefetch" href="/assets/js/21.5bf7b2f3.js"><link rel="prefetch" href="/assets/js/22.888ecbe6.js"><link rel="prefetch" href="/assets/js/23.59391ff8.js"><link rel="prefetch" href="/assets/js/24.b20e6323.js"><link rel="prefetch" href="/assets/js/3.d3831241.js"><link rel="prefetch" href="/assets/js/4.da8b72e6.js"><link rel="prefetch" href="/assets/js/5.048c6337.js"><link rel="prefetch" href="/assets/js/6.29f38f88.js"><link rel="prefetch" href="/assets/js/7.83f34aea.js"><link rel="prefetch" href="/assets/js/8.4d31b438.js"><link rel="prefetch" href="/assets/js/9.31e214be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9825735b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/angelina.jpg" alt="AngelinaBot" class="logo"> <span class="site-name can-hide">AngelinaBot</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能描述" class="dropdown-title"><span class="title">功能描述</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能描述" class="mobile-dropdown-title"><span class="title">功能描述</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Function/基础功能.html" class="nav-link">
  基础功能
</a></li><li class="dropdown-item"><!----> <a href="/Function/模拟抽卡.html" class="nav-link">
  模拟抽卡
</a></li><li class="dropdown-item"><!----> <a href="/Function/游戏数据.html" class="nav-link">
  游戏数据
</a></li><li class="dropdown-item"><!----> <a href="/Function/B站推送.html" class="nav-link">
  B站推送
</a></li><li class="dropdown-item"><!----> <a href="/Function/附加功能.html" class="nav-link">
  附加功能
</a></li><li class="dropdown-item"><!----> <a href="/Function/定时任务.html" class="nav-link">
  定时任务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建部署" class="dropdown-title"><span class="title">搭建部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建部署" class="mobile-dropdown-title"><span class="title">搭建部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Build/部署前言.html" class="nav-link">
  部署前言
</a></li><li class="dropdown-item"><!----> <a href="/Build/登录配置.html" class="nav-link">
  登录配置
</a></li><li class="dropdown-item"><!----> <a href="/Build/闲聊配置.html" class="nav-link">
  闲聊配置
</a></li><li class="dropdown-item"><!----> <a href="/Build/数据更新.html" class="nav-link">
  数据更新
</a></li><li class="dropdown-item"><!----> <a href="/Build/常见错误.html" class="nav-link">
  常见错误
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架开发" class="dropdown-title"><span class="title">框架开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架开发" class="mobile-dropdown-title"><span class="title">框架开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frame/开发须知.html" class="nav-link">
  开发须知
</a></li><li class="dropdown-item"><!----> <a href="/Frame/框架服务.html" class="nav-link">
  框架服务
</a></li><li class="dropdown-item"><!----> <a href="/Frame/如何开发.html" class="nav-link">
  如何开发
</a></li></ul></div></div><div class="nav-item"><a href="/About.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Strelizia02/AngelinaBot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  洁哥源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Strelizia02/AngelinaFrame" target="_blank" rel="noopener noreferrer" class="nav-link external">
  框架源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能描述" class="dropdown-title"><span class="title">功能描述</span> <span class="arrow down"></span></button> <button type="button" aria-label="功能描述" class="mobile-dropdown-title"><span class="title">功能描述</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Function/基础功能.html" class="nav-link">
  基础功能
</a></li><li class="dropdown-item"><!----> <a href="/Function/模拟抽卡.html" class="nav-link">
  模拟抽卡
</a></li><li class="dropdown-item"><!----> <a href="/Function/游戏数据.html" class="nav-link">
  游戏数据
</a></li><li class="dropdown-item"><!----> <a href="/Function/B站推送.html" class="nav-link">
  B站推送
</a></li><li class="dropdown-item"><!----> <a href="/Function/附加功能.html" class="nav-link">
  附加功能
</a></li><li class="dropdown-item"><!----> <a href="/Function/定时任务.html" class="nav-link">
  定时任务
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="搭建部署" class="dropdown-title"><span class="title">搭建部署</span> <span class="arrow down"></span></button> <button type="button" aria-label="搭建部署" class="mobile-dropdown-title"><span class="title">搭建部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Build/部署前言.html" class="nav-link">
  部署前言
</a></li><li class="dropdown-item"><!----> <a href="/Build/登录配置.html" class="nav-link">
  登录配置
</a></li><li class="dropdown-item"><!----> <a href="/Build/闲聊配置.html" class="nav-link">
  闲聊配置
</a></li><li class="dropdown-item"><!----> <a href="/Build/数据更新.html" class="nav-link">
  数据更新
</a></li><li class="dropdown-item"><!----> <a href="/Build/常见错误.html" class="nav-link">
  常见错误
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架开发" class="dropdown-title"><span class="title">框架开发</span> <span class="arrow down"></span></button> <button type="button" aria-label="框架开发" class="mobile-dropdown-title"><span class="title">框架开发</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Frame/开发须知.html" class="nav-link">
  开发须知
</a></li><li class="dropdown-item"><!----> <a href="/Frame/框架服务.html" class="nav-link">
  框架服务
</a></li><li class="dropdown-item"><!----> <a href="/Frame/如何开发.html" class="nav-link">
  如何开发
</a></li></ul></div></div><div class="nav-item"><a href="/About.html" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/Strelizia02/AngelinaBot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  洁哥源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/Strelizia02/AngelinaFrame" target="_blank" rel="noopener noreferrer" class="nav-link external">
  框架源码
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>如何开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#maven" class="sidebar-link">Maven</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#启动类" class="sidebar-link">启动类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#简单回复" class="sidebar-link">简单回复</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#service" class="sidebar-link">Service</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#数据库" class="sidebar-link">数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#数据库配置" class="sidebar-link">数据库配置</a></li><li class="sidebar-sub-header"><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#数据库操作" class="sidebar-link">数据库操作</a></li></ul></li><li><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#配置文件" class="sidebar-link">配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#yml" class="sidebar-link">yml</a></li><li class="sidebar-sub-header"><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#spring配置" class="sidebar-link">Spring配置</a></li><li class="sidebar-sub-header"><a href="/Frame/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91.html#angelinaframe配置" class="sidebar-link">AngelinaFrame配置</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="如何开发"><a href="#如何开发" class="header-anchor">#</a> 如何开发</h1> <hr> <div class="custom-block tip"><p class="custom-block-title">一句话使用(以群聊的回复方法为例)</p> <p><strong>依赖AngelinaFrame的Maven -&gt; 在service目录下新建一个你自己的业务XxxService.java -&gt; Class加上@Service注解 -&gt; 创建一个xxx方法实现你的业务逻辑 -&gt; xxx方法返回类型为ReplayInfo，参数是MessageInfo -&gt; xxx方法前加上@AngelinaGroup注解 -&gt; 补充KeyWords触发关键字 -&gt; 为你的项目添加启动类 -&gt; start -&gt; Over。</strong></p></div> <h2 id="maven"><a href="#maven" class="header-anchor">#</a> Maven</h2> <p>开发者需要使用Maven，依赖AngelinaFrame。AngelinaFrame中已依赖了SpringBoot和Mybatis相关包，除需要覆盖二者版本外，开发者无需再次声明依赖。</p> <p>Pom配置示例</p> <div class="language-pom extra-class"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;top.angelina-bot&lt;/groupId&gt;
    &lt;artifactId&gt;angelinaFrame&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div><h2 id="启动类"><a href="#启动类" class="header-anchor">#</a> 启动类</h2> <p>开发者需要遵从SpringBoot的启动类配置方式，并且使用scanBasePackages 标注需要扫描的包名。包名必须包含AngelinaFrame的包名，和你自己代码的包名。</p> <p>启动类示例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//&quot;com.example.xxx&quot;是你的项目包名，scanBasePackages 必须包含AngelinaFrame的包名和你的包名。</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>scanBasePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;top.angelinaBot.dao&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.example.xxx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token annotation punctuation">@EnableScheduling</span>
<span class="token annotation punctuation">@EnableAsync</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AngelinaApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">AngelinaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="简单回复"><a href="#简单回复" class="header-anchor">#</a> 简单回复</h2> <p>对于非常简单的群聊回复逻辑，AngelinaFrame提供了一个chatReplay.json的配置，无需编写代码。</p> <div class="custom-block warning"><p class="custom-block-title">提示</p> <p>chatReplay.json并非代码中内容，而是在项目启动后，会在jar包同目录下生成一个chatReplay.json文件，使用文本编辑器进行修改。修改后需重启jar生效。</p></div> <p>非常简单的逻辑指：</p> <p>群聊时，用户输入某个关键词后，在n条文字内容中，随机选择任意一条进行回复。</p> <p>chatReplay.json配置示例：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;keyWords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;早安&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;早上好&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;replay&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;早上好，{userName}&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;{userName}，早上好&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;keyWords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;晚安&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;晚上好&quot;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;replay&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;晚上好，{userName}&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;{userName}，晚安&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>{userName}在实际发送中，会替换成用户昵称</li></ul> <h2 id="service"><a href="#service" class="header-anchor">#</a> Service</h2> <p>Service特指需要开发的业务逻辑，AngelinaFrame已经将输入输出为开发者封装好，开发者仅需从输入中获取所需信息，编写逻辑按要求输出即可。</p> <p>AngelinaFrame项目的多样性较少，因此不采用接口的方式，直接实现Service类。</p> <p>Service示例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span><span class="token comment">//由Spring容器对实例进行托管</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorldService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@AngelinaGroup</span><span class="token punctuation">(</span>keyWords <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//当QQ群聊中呼叫【洁哥Hello】或【洁哥hello】时，调用该方法</span>
    <span class="token keyword">public</span> <span class="token class-name">ReplayInfo</span> <span class="token function">helloWorld</span><span class="token punctuation">(</span><span class="token class-name">MessageInfo</span> messageInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ReplayInfo</span> replayInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReplayInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        replayInfo<span class="token punctuation">.</span><span class="token function">setReplayMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Angelina Hello World！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> replayInfo<span class="token punctuation">;</span><span class="token comment">//将你的返回结果封装成ReplayInfo</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h2> <h3 id="数据库配置"><a href="#数据库配置" class="header-anchor">#</a> 数据库配置</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>AngelinaFrame追求一键启动，不依赖其他的服务，因此采用Sqlite数据库。原则上开发者的项目也需要依赖Sqllite，但不限于Sqlite，开发者可根据自己的需求选择<em>现代</em>数据库（如Oracle,MySQL,MongoDB等），开发者依赖的数据库需自行进行启动/关闭。</p></div> <div class="custom-block tip"><p class="custom-block-title">AngelinaFrame的初心</p> <p>启动程序仅需一个Jar包，不依赖其他内容。</p></div> <p>数据库配置(以Sqlite为例)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">&quot;com.example.dao&quot;</span><span class="token punctuation">,</span>
        sqlSessionTemplateRef <span class="token operator">=</span> <span class="token string">&quot;localSqlSessionTemplate&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LocalDataSourceConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 创建数据源
     */</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;localDataSource&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">getFirstDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> dir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;runFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dir<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">boolean</span> mkdir <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;runFile/local.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;/sqlite/template.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">FileOutputStream</span> fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token keyword">while</span> <span class="token punctuation">(</span>is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;创建数据库文件失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">DataSourceBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">driverClassName</span><span class="token punctuation">(</span><span class="token string">&quot;org.sqlite.JDBC&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc:sqlite:&quot;</span> <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;localSqlSessionFactory&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionFactory</span> <span class="token function">localSqlSessionFactory</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;localDataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">SqlSessionFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setMapperLocations</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathMatchingResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:mapping/*.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bean<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> bean<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;localTransactionManger&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSourceTransactionManager</span> <span class="token function">localTransactionManger</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;localDataSource&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DataSourceTransactionManager</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建SqlSessionTemplate</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;localSqlSessionTemplate&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">SqlSessionTemplate</span> <span class="token function">localSqlSessionTemplate</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;localSqlSessionFactory&quot;</span><span class="token punctuation">)</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionTemplate</span><span class="token punctuation">(</span>sqlSessionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数据库操作"><a href="#数据库操作" class="header-anchor">#</a> 数据库操作</h3> <p>AngelinaFrame使用Mybatis进行数据库操作，可自行搜索SpringBoot + Mybatis进行学习。</p> <p>具体代码参考<a href="https://github.com/Strelizia02/AngelinaFrame/tree/master/src/main/java/top/angelinaBot/dao" target="_blank" rel="noopener noreferrer">Mapper接口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,<a href="https://github.com/Strelizia02/AngelinaFrame/tree/master/src/main/resources/mapping" target="_blank" rel="noopener noreferrer">Mapping配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h1 id="启动配置"><a href="#启动配置" class="header-anchor">#</a> 启动配置</h1> <h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <div class="custom-block tip"><p class="custom-block-title">SpringBoot配置文件的优先级</p> <p><strong>jar同目录下的配置文件 &gt; jar内部的配置文件</strong>，因此可以将源码中配置文件拷出，放置在jar同目录下，根据实际情况灵活配置，重启jar即可重新加载配置文件。</p></div> <h3 id="yml"><a href="#yml" class="header-anchor">#</a> yml</h3> <p>配置文件采用yml格式，yml配置文件严格要求缩进：</p> <ul><li><p>子分类必须要比父分类缩进2个半角空格</p></li> <li><p>字段名和字段值必须使用一个半角冒号和一个半角空格分割</p></li> <li><p>复杂字符串最好使用单引号引用，存在特殊字符的转义情况</p></li> <li><p>请熟知yml格式，参考源码中<a href="https://github.com/Strelizia02/AngelinaFrame/blob/master/src/main/resources/application.yml" target="_blank" rel="noopener noreferrer">application.yml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h3 id="spring配置"><a href="#spring配置" class="header-anchor">#</a> Spring配置</h3> <ul><li><p>server.port: 8086 项目启动端口，用于web接口的提供，和对接其他QQBot的Http接口。</p></li> <li><p>spring.main.allow-bean-definition-overriding: true 允许Bean配置重复，后加载的Bean会覆盖新加载的，开启后用来覆盖一些配置Bean</p></li></ul> <h3 id="angelinaframe配置"><a href="#angelinaframe配置" class="header-anchor">#</a> AngelinaFrame配置</h3> <ul><li><p>userConfig.botNames Bot的名称，考虑到Bot可能存在多个昵称的情况，请使用空格进行分割</p></li> <li><p>userConfig.qqList Bot的账号池，多个账号用空格分割</p></li> <li><p>userConfig.pwList 明文存储账号密码</p></li> <li><p>scheduled.xxxJob xxxjob定时任务的<a href="https://cron.qqe2.com/" target="_blank" rel="noopener noreferrer">Cron表达式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4012ad7.js" defer></script><script src="/assets/js/2.3c2e6582.js" defer></script><script src="/assets/js/13.868abce9.js" defer></script>
  </body>
</html>
