# 开发准则

## 责任声明

AngelinaFrame（以下简称为**本项目**）为基于SpringBoot，简化Java开发QQBot的框架，**本项目**并不提供任何QQ协议。本质上可以集成任何一款QQBot框架，通过QQBot框架提供的QQ协议，进行自动化的接受、回复消息功能。

***

::: danger 再次强调，使用本项目请务必遵守当地法律法规，禁止使用本项目进行任何违法违规活动，包括但不限于：
* [传播垃圾广告](https://www.baidu.com/s?ie=UTF-8&wd=%E4%BC%A0%E6%92%AD%E5%9E%83%E5%9C%BE%E4%BF%A1%E6%81%AF%E5%88%A4%E5%87%A0%E5%B9%B4)
* [传播违禁资源](https://www.baidu.com/s?ie=UTF-8&wd=%E4%BC%A0%E6%92%AD%E6%B7%AB%E7%A7%BD%E4%BF%A1%E6%81%AF%E5%88%A4%E5%87%A0%E5%B9%B4)
* [运营非法活动](https://www.baidu.com/s?ie=UTF-8&wd=%E4%BC%A0%E9%94%80%E6%9C%80%E9%AB%98%E5%88%A4%E5%87%A0%E5%B9%B4)
* [电信诈骗](https://www.baidu.com/s?ie=UTF-8&wd=%E7%94%B5%E4%BF%A1%E8%AF%88%E9%AA%97%E6%9C%80%E9%AB%98%E5%88%A4%E5%87%A0%E5%B9%B4)

:::

::: warning

**本项目**中需要明文配置QQ账号密码，有极高的密码泄露风险，请勿使用高价值QQ账号进行开发、调试、运营。

:::

QQ账号存在调用发送消息接口成功，但是实际发送失败的情况。这种情况我们一般称为"风控"。

"**风控**"原因分为几种：

* 新注册账号 新注册账号有可能会被长时间"**风控**"，建议注册账号后，经常使用账号聊天提高活跃度，再进行开发、测试。

* 第一次使用某QQ协议 例如**本项目**中默认使用的MiraiQQ框架，第一次登录时必定会出现"**风控**"。请使用该协议保持在线状态一段时间，约1~3天自动解除。

* 账号被封禁 账号因违反用户协议被封禁/冻结等，解封后会有1-3天的"**风控**"期。

* 切换设备登录 Mirai框架本质上会根据你的物理设备信息生成一个模拟的登录设备信息，当你切换运行环境，极大可能会经历滑块验证码/常用设备验证/"**风控**"等。

* 其他框架的"**风控**"原因与上述原因类似，多数情况均可通过"使用该框架保持登录状态1-3天"的方式解决。


***

**本项目**原则上不会保存**聊天记录**，但**聊天记录**会打印成日志。因此有可能出现**用户隐私泄露**的情况（闪照依然会被记录在日志中），请各位开发者务必通知用户有关**隐私保护**的内容。

## 开源协议

**本项目**使用AGPLv3.0协议开源，原则上引用或间接引用**本项目**的代码都应开源。

**本项目**开发目的为学习、讨论，请各位开发者尽可能避免商业用途。

## 开发规范

::: tip

以下开发规范仅为**个人建议**，希望各位开发者在使用**本项目**开发QQBot的过程中，能够遵循以下开发规范

:::

### Bot与账号

Bot为一个服务主体，一个Bot有可能由多个QQ账号组合而成。而用户无需关心具体的QQ账号，仅需在QQ群聊/私聊，输入Bot的命令，即可收到1条来自Bot的回复。

### Bot的唤起

每个Bot都应该拥有一个属于自己的名字，并且在实际的唤起Bot的方法中，必须使用该名称进行唤起。

我认为，作为一个合格的Bot开发者，首要考虑的并不是你的Bot功能应该做到多么丰富，而是需要保证在用户不想使用的情况下，不要让Bot打扰用户的正常聊天。
同时Bot命名也可以降低多个Bot包含同样触发条件时，循环触发导致死循环的风险。

因此将你的Bot进行命名，并且开发者使用的时候必须键入Bot的名称，否则一切业务逻辑(除定时任务)都不会触发。

例如：

* 【洁哥天气】——触发名为洁哥Bot的查看天气功能 √

* 【天气】——触发查看天气功能 **×**

原因：用户正常聊天中，某些词属于高频触发，例如当用户在发送

***

玩亚索又是0-7，今天气死我了

***

本质上没有主观唤起bot，却因为包含某些字样触发了Bot。

* 【早安】——触发早安回复功能 **×**

用户输入早安后，因为群内包含多个Bot，导致连续触发

***

用户：早安

Bot1：早安，用户

Bot2：早安，用户

Bot2：早安，Bot1

Bot1：早安，Bot2

...

***

::: tip 

本项目中强制要求开发者配置botNames信息

:::

### Bot定时任务

部分Bot业务中可能会包含定时任务的功能，例如"早安问候"，"生日提醒"等。

在安排定时任务时，应遵循"低频率"的原则，不要让Bot的定时任务不断的刷屏影响用户正常使用。

### Bot速率限制

鉴于多个Bot之间循环发送的情况较多，Bot的开发者最好在Bot代码中限制单人的回复速率，防止多个Bot之间死循环。

**本项目**中已包含速率限制，单人10s内超过3条消息，会提示效率过快，超过5条消息会停止回复该用户，直到最近10s内消息总数小于3条恢复正常。（正常单人连续聊天速率约为1条/3秒）

### 用户输入

应让用户去学习你的Bot使用方式，而不是让你的Bot很轻易就可以被用户输入唤起。一定要对用户的输入做校验。

作为一个专业的开发者，永远不要相信你的用户输入，尽可能减少直接输出用户的输入内容。用户的输入具有多样化的特性，经典"用户点了一碗炒饭"的问题，尤其是部分恶意用户会利用你的系统漏洞作出攻击，简单的攻击比如有一个复读机功能，用户让你的Bot复读一个违禁语句，然后举报，这会导致你的Bot封号。

网络安全中，多数的系统漏洞都是因为相信用户输入而造成"用户点了一碗炒饭，酒吧炸了"的情况，无论是从你的账号安全角度，还是从Bot的运行稳定性角度，都尽可能的不去相信用户输入，减少各种意外风险。

***

漏洞案例：相信用户输入导致的漏洞，java史上最大漏洞，log4j的jndi注入。

***
